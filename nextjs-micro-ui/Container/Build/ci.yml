trigger:
  - master

pool:
  vmImage: 'windows-latest'

variables:
  buildDir: 'Container/.next'
  artifactName: 'nextjs-micro-ui'

stages:
  - stage: Build_QA
    displayName: 'Build QA'
    jobs:
      - job: Build
        steps:
          - checkout: self

          - task: NodeTool@0
            inputs:
              versionSpec: '18.x'
            displayName: 'Install Node.js'

          - script: |
              cd Container
              npm ci
              npm run build:qa
            displayName: 'Build QA'

          - publish: 'Container/.next'
            artifact: '$(artifactName)-qa'

  - stage: Build_Staging
    displayName: 'Build Staging'
    dependsOn: Build_QA
    jobs:
      - job: Build
        steps:
          - checkout: self

          - task: NodeTool@0
            inputs:
              versionSpec: '18.x'
            displayName: 'Install Node.js'

          - script: |
              cd Container
              npm ci
              npm run build:staging
            displayName: 'Build Staging'

          - publish: 'Container/.next'
            artifact: '$(artifactName)-staging'

  - stage: Build_Prod
    displayName: 'Build Production'
    dependsOn: Build_Staging
    jobs:
      - job: Build
        steps:
          - checkout: self

          - task: NodeTool@0
            inputs:
              versionSpec: '18.x'
            displayName: 'Install Node.js'

          - script: |
              cd Container
              npm ci
              npm run build
            displayName: 'Build Production'

          - publish: 'Container/.next'
            artifact: '$(artifactName)-prod'